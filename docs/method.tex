\chapter{AHTR Modeling and Optimization Methodology}
\label{chap:method}
In this chapter, I describe the modeling and optimization methodology of the 
\acrfull{AHTR} optimization for non-conventional geometries and parameters
conducted using \acrfull{ROLLO}.
The optimization tool should enable the placement of fuel, moderation, and coolant 
material in any possible location, within physical limits, to wholly explore the 
design space enabled by additive manufacturing. 
Since exploring non-conventional geometries and parameters has barely been
attempted (previous attempts described in Section \ref{sec:lit-review-reactor-arbitrary}), 
this dissertation does one of the first goes at beginning to explore the large design 
space. 
The work done for this dissertation is only an intermediate step towards developing 
a truly arbitrary geometry expression. 

The subsequent sections define the optimization problem definitions, describe the 
\gls{AHTR} geometries, outline the \gls{AHTR} modeling workflow, verify the \gls{AHTR} 
models, and describe the process of tuning \gls{ROLLO}'s hyperparameters for the optimization 
problems.

\section{ROLLO Optimization Problem Definitions}
\label{sec:opt-problem}
In an effort toward optimizing the \gls{AHTR} design for non-conventional geometries 
and parameters.
I chose to vary the following \gls{AHTR} parameters: 
\begin{itemize}
    \item \gls{TRISO} packing fraction distribution
    ($\rho_{TRISO}(\vec{r})$)
    \item Total fuel packing fraction
    \item \gls{FLiBe} coolant channel shape 
\end{itemize} 
The TRISO packing fraction distribution variation enables exploration of how 
heterogeneous fuel distributions impact reactor performance.
In Section \ref{sec:fhr-benchmark-keff}, the \gls{FHR} benchmark results demonstrated 
that increased fuel packing does not always correspond with increased $k_{eff}$ due to 
self-shielding effects. 
Varying total fuel packing fraction and TRISO distribution synergistically enable 
exploration of how heterogenous TRISO distribution could minimize self-shielding and 
thus, reduce the fuel required for a reactor design. 
The \gls{FLiBe} coolant channel shape variation enables exploration of how non-uniform 
channel shapes impact reactor performance. 

I selected three key \gls{AHTR} optimization objectives that address contrasting reactor 
core qualities. 
Table \ref{tab:objectives} describes each objective, how I quantified them, and the motivation.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{ROLLO} optimization problem objectives with their quantification 
    descriptions and motivation.}
	\label{tab:objectives}
    \footnotesize
    \begin{tabular}{p{4.5cm}|p{5cm}p{5cm}}
    \hline 
    \textbf{Objective}& \textbf{Quantification}& \textbf{Motivation} \\
    \hline
    \textbf{Minimize fuel amount} & Minimize total fuel packing fraction 
    & Cost savings, Non-proliferation \\ 
    \hline
    \textbf{Maximize heat transfer} & Minimize maximum temperature 
    & Enable the system to perform at a higher power with minimized thermal stress \\
    \hline
    \textbf{Minimize power peaking} & Minimize power peaking factor normalized by fuel distribution 
    & Efficient fuel utilization, longer core life, safety\\
    \hline
    \end{tabular}
\end{table}

To optimize the described objectives, I will vary the described parameters in the
\gls{AHTR} plank and one-third assembly models. 
The optimization results for the \gls{AHTR} plank and one-third assembly models are 
reported in Chapters \ref{chap:ahtr-plank-opt-results} and \ref{chap:ahtr-assem-opt-results}, 
respectively. 
The plank optimization is a preliminary study to inform the more complex \gls{AHTR} 
one-third assembly optimization setup. 
In the next section, I will describe both geometries. 

\section{AHTR Geometry for Optimization Problem}
I apply the optimization process to the \gls{AHTR} plank and \gls{AHTR} one-third
assembly geometries.
The geometries are adapted from the \gls{FHR} benchmark's \gls{AHTR} design,
outlined in Chapter \ref{chap:fhr-benchmark} (see Figure \ref{fig:ahtr-fuel-assembly}).
The main differences occur in the fuel plank region. 
In the \gls{FHR} benchmark, the TRISO particles are arranged in rectangular lattices within
two fuel stripes in the fuel plank region. 
For the optimization problem, I discretized each plank into ten cells with random 
TRISO packing and an individually controlled packing fraction. 
Thus, the \gls{AHTR} plank has ten fuel cells, and the \gls{AHTR} one-third assembly 
has 60 fuel cells.  
The subsequent sub-sections describe each geometry in further detail.
I also omit the graphite spacers. 

\subsection{AHTR Plank Geometry}
\label{sec:ahtr-plank-geometry}
The \gls{AHTR} plank is a single graphite fuel plank model from the \gls{AHTR} design 
(Figure \ref{fig:ahtr-fuel-assembly}). 
I modified the fuel plank to be straightened with perpendicular sides instead 
of slanted as in Figure \ref{fig:ahtr-fuel-plank} for ease of modeling. 
The one-third assembly optimization uses the original slanted \gls{AHTR} planks. 
Figure \ref{fig:straightened_plank} illustrates the straightened fuel plank with 
ten fuel cells with random \gls{TRISO} packing.
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.85\linewidth]{straightened_plank.png}
    \begin{tikzpicture}
        \draw[ thick,-latex] (0,0) -- (1,0) node[anchor=south west] {$x$};
        \draw[ thick,-latex] (0,0) -- (0,1) node[anchor=south west] {$y$};
        \draw[ thick,-latex] (0,0) -- (1,1) node[anchor=south west] {$z$};
       \tkzText[above](-0.3,-0.7){}
       \end{tikzpicture} 
    \raggedright
    \resizebox{0.3\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} \\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure)\\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 

            \end{tabular}}}
    \caption{Straightened \acrfull{AHTR} fuel plank with 10 fuel cells with random 
    TRISO packing. Original slanted fuel planks can be seen in Figures 
    \ref{fig:ahtr-fuel-assembly} and \ref{fig:ahtr-fuel-plank}.}
    \label{fig:straightened_plank}
\end{figure}
The plank has $27.1 \times 3.25 \times 1.85\ cm^3$ dimensions with reflective 
boundary conditions.

I used the same materials as in the \gls{FHR} benchmark (Chapter \ref{chap:fhr-benchmark}), 
except that I homogenized each \gls{TRISO} particle's four outer layers: 
porous carbon buffer, inner pyrolytic carbon, silicon carbide layer, and the 
outer pyrolytic carbon. 
The \gls{TRISO} particle dimensions remain the same.
Table \ref{tab:keff_triso} reports OpenMC's $k_{eff}$ for the straightened \gls{AHTR} configuration 
with and without the outer layer \gls{TRISO} homogenization.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{Straightened \acrfull{AHTR} fuel plank $k_{eff}$ for the case with 
    no \gls{TRISO} homogenization and case with homogenization of the four outer 
    layers. Both simulations were run on one BlueWaters XE Node.}
	\label{tab:keff_triso}
    \footnotesize
    \begin{tabular}{llc}
    \hline 
    \textbf{TRISO Homogenization}& \textbf{$k_{eff}$} & \textbf{Simulation time [s]}  \\
    \hline 
    None & $1.38548 \pm 0.00124$ & 233\\ 
    Four outer layers & $1.38625 \pm 0.00109$ & 168\\ 
    \hline
    \end{tabular}
\end{table}
The \gls{TRISO} particle outer four-layer homogenization resulted in a $30\%$ 
speed-up without compromising accuracy with $k_{eff}$ values within each 
other's uncertainty.

\subsection{AHTR One-Third Assembly Geometry}
\label{sec:ahtr-assem-geometry}
The \gls{AHTR} one-third assembly is one-diamond shape sector of the \gls{AHTR} assembly. 
The one-third assembly contains six graphite fuel planks.
Each graphite fuel plank has graphite buffers and ten rectangular prism fuel cells 
with random TRISO packing and individually controlled packing fractions. 
Figure \ref{fig:ahtr_assembly} shows the one-third \gls{AHTR} assembly with 10 x 6 
fuel cells with random \gls{TRISO} packing.
\begin{figure}[htbp]
    \centering
    \begin{subfigure}{.7\textwidth}
    \includegraphics[width=\linewidth]{ahtr_assembly.png}
    \end{subfigure}%
    \begin{subfigure}{.3\textwidth}
        \begin{tikzpicture}
            \draw[ thick,-latex] (0,0) -- (1,0) node[anchor=south west] {$x$};
            \draw[ thick,-latex] (0,0) -- (0,1) node[anchor=south west] {$y$};
            \draw[ thick,-latex] (0,0) -- (1,1) node[anchor=south west] {$z$};
           \tkzText[above](-0.3,-0.7){}
        \end{tikzpicture} 
        \vspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} \\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure)\\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
            \end{tabular}}
    \end{subfigure}
    \caption{\acrfull{AHTR} one-third assembly with ten fuel cells in each graphite plank 
    with random TRISO packing. Original \gls{FHR} benchmark fuel assembly with fuel 
    stripes can be seen in Figure \ref{fig:ahtr-fuel-assembly}.}
    \label{fig:ahtr_assembly}
\end{figure}
The one-third assembly model has reflective boundary conditions and  
uses the \gls{TRISO} particle outer four-layer 
homogenization described in Section \ref{sec:ahtr-plank-geometry}.

\section{AHTR Model Workflow}
The \gls{ROLLO} software drives the evolutionary algorithm optimization process, 
depicted in Figure \ref{fig:genetic_alg_nuclear}. 
In a \gls{ROLLO} input file, I define control variables for the genetic algorithm 
to vary. 
These control variables control the \gls{AHTR} parameters described in 
Section \ref{sec:opt-problem}.
The control variables are input into the nuclear software templates to model different 
AHTR geometries.
The nuclear software will then run the \gls{AHTR} models and calculate the optimization 
objective and constraint values. 
In this work, I use OpenMC \cite{romano_openmc:_2015} to model \gls{AHTR}'s neutronics 
and Moltres \cite{lindsay_introduction_2018} to model the \gls{AHTR}'s multi-physics. 
Descriptions of each software can be found in Section 
\ref{sec:lit-review-modeling-software}.

In the following sub-sections, I describe the \gls{AHTR} modeling workflow: the
\gls{AHTR} input parameters, the OpenMC and Moltres models, and the output 
and constraint values calculations. 
The \gls{AHTR} modeling workflow described in this section falls within the 
\textit{evaluate population} orange blocks in Figure \ref{fig:genetic_alg_nuclear}'s 
genetic algorithm flow chart.
Figure \ref{fig:ahtr-model-flow} illustrates the modeling workflow. 
\begin{figure}[htbp]
    \centering
    \begin{tikzpicture}[node distance=0.5cm]
        \tikzstyle{every node}=[font=\footnotesize]
        \node (1) [e72block] {\textit{Total PF}};
        \node (2) [b72block, right=of 1] {PF};
        \node (3) [e82block, above=of 2] {Control Parameters};
        \node (4) [e72block, below=of 1] {$\rho_{TRISO}(\vec{r})$};
        \node (5) [b72block, right=of 4] {a, b, c, d, e, f};
        \node (6) [e72block, below=of 4] {\gls{FLiBe} Coolant Channel Shape};
        \node (7) [b72block, right=of 6] {$r_{top}$, $r_{bot}$, $r_i$};
        \node (8) [o72block, right=of 2, xshift=0.8cm, yshift=0.5cm] {OpenMC Model};
        \node (9) [e92block, above=of 8] {Nuclear Software Models};
        \node (10) [o72block, right=of 5, xshift=0.8cm] {Group Constants};
        \node (11) [o72block, right=of 7, xshift=0.8cm, yshift=-0.5cm] {Moltres Model};
        \node (12) [b72block, right=of 8, xshift=0.8cm, yshift=0.8cm] {$k_{eff}$}; 
        \node (13) [e72block, above=of 12] {Constraints};
        \node (14) [e72block, below=of 12] {Objectives};
        \node (15) [b72block, below=of 14] {PF};
        \node (16) [b72block, below=of 15] {PPF};
        \node (17) [b72block, below=of 16] {$T_{max}$};
        \draw [arrow] (2) -- ([shift={(0cm,0cm)}]2.east) -- ([shift={(0cm,0cm)}]8.west);
        \draw [arrow] (5) -- ([shift={(0cm,0cm)}]5.east) -- ([shift={(0cm,0cm)}]8.west);
        \draw [arrow] (7) -- ([shift={(0cm,0cm)}]7.east) -- ([shift={(0cm,0cm)}]8.west);
        \draw [arrow] (7) -- ([shift={(0cm,0cm)}]7.east) -- ([shift={(0cm,0cm)}]11.west);
        \draw [arrow] (8) -- ([shift={(0cm,0cm)}]8.south) -- node[anchor=west] {generates} ([shift={(0cm,0cm)}]10.north);
        \draw [arrow] (10) -- ([shift={(0cm,0cm)}]10.south) -- node[anchor=west] {input into} ([shift={(0cm,0cm)}]11.north);
        \draw [arrow] (8) -- ([shift={(0cm,0cm)}]8.east) -- ([shift={(0cm,0cm)}]12.west);
        \draw [arrow] (8) -- ([shift={(0cm,0cm)}]8.east) -- ([shift={(0cm,0cm)}]15.west);
        \draw [arrow] (8) -- ([shift={(0cm,0cm)}]8.east) -- ([shift={(0cm,0cm)}]16.west);
        \draw [arrow] (11) -- ([shift={(0cm,0cm)}]11.east) -- ([shift={(0cm,0cm)}]17.west);
    \end{tikzpicture}
    \caption{\acrfull{AHTR} modeling workflow in \acrfull{ROLLO} optimization. The entire 
    workflow falls within the 'evaluate population' orange blocks in ROLLO's evolutionary 
    algorithm optimization process depicted in Figure \ref{fig:genetic_alg_nuclear}. 
    For each reactor model in the optimization process, the modeling workflow begins 
    with ROLLO selecting the control parameters. 
    ROLLO inserts control parameters into templated OpenMC and Moltres input files. 
    The OpenMC and Moltres models are run. 
    ROLLO analyzes the OpenMC and Moltres output files to determine constraint and 
    objective values.
    PF: Total packing fraction, $\rho_{TRISO}(\vec{r})$: TRISO packing fraction 
    distribution, PPF: normalized power peaking factor, $T_{max}$: model's maximum 
    temperature.} 
    \label{fig:ahtr-model-flow}
\end{figure}

\subsection{Input Parameter Modeling}
\label{sec:input-parameter-modeling}
This section describes how I model the \gls{AHTR} input parameter variations: 
total fuel packing fraction, \gls{TRISO} particle packing fraction distribution, 
and \gls{FLiBe} coolant channel shape. 
For both the \gls{AHTR} plank and one-third assembly models, the total fuel packing 
fraction parameter is a single numerical input.
In the subsequent subsections, I describe how I modeled the other two parameters for 
the \gls{AHTR} plank and one-third assembly models. 

\subsubsection{Input Parameter Modeling: TRISO particle packing fraction distribution}
I utilize sine distributions for both the \gls{AHTR} plank and one-third assembly 
models to govern the \gls{TRISO} packing fraction distribution.
Based on the sine distributions, the model calculates each fuel cell's packing 
fraction, then uses OpenMC's \texttt{pack\_spheres} function to randomly disperse 
the packing fraction in each fuel cell. 
For the \gls{AHTR} plank, one sine distribution governs the \gls{TRISO} packing 
fraction distribution across the \gls{AHTR} plank's x-direction. 
For the \gls{AHTR} one-third assembly, two sine distributions govern the \gls{TRISO} 
packing fraction distribution across each fuel plank's x-direction and the 
assembly's y-direction, respectively. 

For the \gls{AHTR} plank, Equation \ref{eq:plank-sine}'s sine distribution governs 
the \gls{TRISO} particle packing fraction distribution across the ten fuel cells:
\begin{align}
    \label{eq:plank-sine}
    PF(x) &= \left(a\cdot sin(b\cdot x + c) + 2\right) \cdot NF\\
    \intertext{where}
    PF(x) &= \mbox{packing fraction distribution across ten cells } [-] \nonumber \\ 
    a &= \mbox{amplitude, peak deviation of the function from zero } [-] \nonumber \\
    b &= \mbox{angular frequency, rate of change of the function argument } [\frac{radians}{cm}] \nonumber \\
    c &= \mbox{phase, the position in its cycle the oscillation is at t = 0 } [radians]\nonumber \\
    x &= \mbox{midpoint value for each cell } [cm]\nonumber \\
    NF &= \mbox{normalization factor } [-]\nonumber
\end{align}
Figure \ref{fig:straightened_plank} depicts the ten fuel cells.
The sine distribution's coefficients, \textit{a b c}, are the control variables 
\gls{ROLLO} utilizes to control the plank's TRISO packing fraction distribution.
Thus, \gls{ROLLO} will vary $a, b, c$ variables to find an optimal TRISO particle 
sine distribution. 
The normalization factor normalizes the \gls{TRISO} distribution based on the 
defined total packing fraction.

An \gls{AHTR} plank with a 0.0979 total packing fraction, and packing fraction 
distribution of $PF(x) = \left(0.5\cdot sin(\frac{\pi}{3}\cdot x + \pi) + 2\right) 
\cdot NF$, results in the following packing fractions for the ten cells: 0.103, 0.120, 
0.049, 0.138, 0.076, 0.081, 0.136, 0.048, 0.125, and 0.098. 
Figure \ref{fig:triso_distribution} shows this sine distribution, highlights 
the packing fraction at the respective midpoints, and displays the plank's x-y 
axis view with the packing fraction varying based on this sine distribution. 
\begin{figure}[htbp]
    \centering
    \makebox[\textwidth][c]{\includegraphics[width=1.1\linewidth]{triso_distribution_sine.png}} 
    \caption{Above: Straightened \acrfull{AHTR} fuel plank with varying \gls{TRISO} particle 
    distribution across ten cells based on the sine distribution. 
    Below: $PF(x) = (0.5\ sin(\frac{\pi}{3}x + \pi) + 2)  \times NF$ 
    sine distribution with red points indicating the packing fraction at each cell.}
    \label{fig:triso_distribution}
\end{figure}

For the \gls{AHTR} one-third assembly, Equation \ref{assem-sine}'s two sine 
distributions govern \gls{TRISO} packing fraction distributions in the x and y direction 
for the 10 x 6 fuel cells:
\begin{align}
    \label{assem-sine}
    PF(x, y) &= \left(a\cdot sin(b\cdot x + c) + 2\right) 
    \cdot \left(d\cdot sin(e\cdot y + f) + 2\right) \cdot NF \\
    \intertext{where}
    PF(x, y) &= \mbox{packing fraction distribution across 60 cells } [-] \nonumber \\ 
    a, d &= \mbox{amplitude, peak deviation of the function from zero } [-] \nonumber \\
    b, e &= \mbox{angular frequency, rate of change of the function argument } [\frac{radians}{cm}] \nonumber \\
    c, f &= \mbox{phase, the position in its cycle the oscillation is at t = 0 } [radians]\nonumber \\
    x &= \mbox{midpoint value for each x-direction fuel cell } [cm]\nonumber \\
    y &= \mbox{midpoint value for each fuel plank } [cm]\nonumber \\
    NF &= \mbox{normalization factor } [-]\nonumber
\end{align}
Figure \ref{fig:ahtr_assembly} depicts the 10 x 6 fuel cells.
The sine distribution's coefficients, \textit{a b c d e f}, are the control variables 
\gls{ROLLO} utilizes to control the TRISO packing fraction distribution in the 
one-third assembly.
Thus, \gls{ROLLO} will vary \textit{a b c d e f} constants to find an optimal TRISO 
distribution. 
The normalization factor normalizes the \gls{TRISO} distribution based on the 
defined total packing fraction.

An \gls{AHTR} one-third assembly with a 0.1 total packing fraction and packing 
fraction distribution of $PF(x, y) = \left(0.5\cdot sin(1\cdot x + 1) + 2\right) \cdot 
\left(0.7\cdot sin(1.5\cdot y + 2) + 2\right) \cdot NF$ results in the packing fraction 
distribution shown in Figure \ref{fig:ahtr-assem-triso-distr-squares}, which 
corresponds to the one-third assembly with varying TRISO distribution in its fuel 
cells, shown in Figure \ref{fig:ahtr-assem-triso-distr}. 
\begin{figure}[htbp]
    \centering
    \begin{subfigure}{0.49\textwidth}
        \includegraphics[width=\linewidth]{ahtr-assem-triso-distr-squares.png}
        \caption{TRISO packing fraction distribution values.}
        \label{fig:ahtr-assem-triso-distr-squares} 
    \end{subfigure}
    \begin{subfigure}{0.49\textwidth}
        \includegraphics[width=\linewidth]{ahtr-assem-triso-distr.png}
        \raggedleft
        \resizebox{0.5\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} \\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure) \\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
        \end{tabular}}}
        \caption{TRISO distribution in one-third assembly model.}
        \label{fig:ahtr-assem-triso-distr} 
    \end{subfigure}
    \caption{\acrfull{AHTR} one-third assembly with varying \gls{TRISO} particle 
        distribution across 10 x 6 cells based on the sine distributions: $PF(x, y) = 
        \left(0.5\cdot sin(1\cdot x + 1) + 2\right) \cdot 
        \left(0.7\cdot sin(1.5\cdot y + 2) + 2\right) \cdot NF$. 
        The packing fraction values on the left correspond to the TRISO 
        distribution in the one-third assembly on the right.}
\end{figure}

\subsubsection{Input Parameter Modeling: \gls{FLiBe} Coolant Channel Shape}
For both the \gls{AHTR} plank and one-third assembly models, I model the variation in 
coolant channel shape with a sinusoidal-like pattern, using OpenMC's cylinder surfaces
functionality.
By varying the cylinders' radius, the coolant channel shapes' depth and frequency 
mimic a sinusoidal pattern.
I vary the \gls{FLiBe} coolant channel shape while holding the total coolant volume 
constant. 

For the \gls{AHTR} plank, $r_{top}$ and $r_{bot}$ variables control the coolant channel 
shape on the top and bottom \gls{FLiBe} channels. 
Figure \ref{fig:coolant-channel-shape} shows the \gls{AHTR} plank's coolant channel 
shape for $r_{top} = 0.2$ and $r_{bot} = 0.3$.
\begin{figure}[htbp]
    \centering
        \includegraphics[width=\linewidth]{coolant-channel-shape.png}
    \raggedright
    \resizebox{0.3\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} Coolant\\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure) \\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
        \end{tabular}}}
    \caption{\acrfull{AHTR} plank with coolant shape variation, $r_{top} 
    = 0.2$ and $r_{bot} = 0.3$.}  
    \label{fig:coolant-channel-shape}
\end{figure}
Thus, \gls{ROLLO} will vary $r_{top}$ and $r_{bot}$ to find optimal coolant 
channel shapes for the \gls{AHTR} plank model.

% TODO: Assembly COolant channel shape variation
For the \gls{AHTR} one-third assembly, $r_1, r_2, r_3, r_4, r_5$ variables control the
coolant channel shape in the inter-plank \gls{FLiBe}. 
Figure \ref{fig:coolant-channel-shape-assem} shows the \gls{AHTR} one-third assembly's 
inter-plank coolant channel shapes for $r_1, r_2, r_3, r_4, r_5 = ... $
% add figure
\begin{figure}[htbp]
    \centering
        \includegraphics[width=\linewidth]{coolant-channel-shape.png}
    \raggedright
    \resizebox{0.3\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} Coolant\\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure) \\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
        \end{tabular}}}
    \caption{\acrfull{AHTR} one-third assembly with coolant shape variation ...}  
    \label{fig:coolant-channel-shape-assem}
\end{figure}
Thus, \gls{ROLLO} will vary $r_1, r_2, r_3, r_4, r_5$ to find optimal coolant 
channel shapes for the \gls{AHTR} one-third assembly model.

\subsection{AHTR OpenMC and Moltres Models}
\label{sec:ahtr-moltres-hom}
The input parameters outlined in the previous section are inputs into 
the OpenMC neutronics and Moltres temperature models. 
The Moltres model relies on group constant data produced by the OpenMC model. 
The OpenMC and Moltres models' workflow:  
\begin{enumerate}
\item OpenMC neutronics model
\item OpenMC neutronics model produces group constants data for the Moltres 
model
\item Moltres model mesh generation 
\item Moltres temperature model accepts group constants data and mesh
\end{enumerate}
In the subsequent subsections, I describe details and assumptions for each step of 
the OpenMC and Moltres models' workflow.

\subsubsection{AHTR OpenMC Model}
The OpenMC model template accepts the following input parameters from \gls{ROLLO}: 
total packing fraction ($PF$), TRISO distribution ($a, b, c, d, e, f$), 
and \gls{FLiBe} coolant channel shapes ($r_{top}, r_{bot}, r_1, r_2, r_3, r_4, r_5$). 
The OpenMC model takes the input parameters and generates an \gls{AHTR} model with 
\gls{TRISO} distribution and \gls{FLiBe} coolant channel shape variation. 
A separate OpenMC output file analyzes the OpenMC model's output and 
calculates the $k_{eff}$ constraint and the objective value: normalized power 
peaking factor.
Section \ref{sec:ahtr_slab_output} describes the calculation for each output and 
constraint value.
Figures \ref{fig:triso_distribution}, \ref{fig:ahtr-assem-triso-distr},
\ref{fig:coolant-channel-shape} are \gls{AHTR} model snapshots generated by OpenMC. 

\subsubsection{AHTR Moltres Group Constant Generation}
\label{sec:ahtr-moltres-group-constant-gen}
Unlike the OpenMC model, Moltres does not explicitly model each \gls{TRISO}
particle. 
This is because a TRISO-level fidelity mesh file is impractical and results in
extremely long runtimes. 
Instead, Moltres relies on the OpenMC model to generate group constants data for the 
Moltres' multigroup neutron diffusion calculations. 
Previously, Moltres could only generate group constant data from Serpent 
\cite{leppanen_serpent_2014} or SCALE \cite{bucholz_scale:_1982} output files. 
I implemented functionality in Moltres for group constant data generation with 
OpenMC \cite{lindsay_moltres_2017}. 

To enable successful Moltres \gls{AHTR} model simulations, I established suitable 
spatial and energy homogenization for group constant generation. 
These homogenizations preserve accuracy while maintaining an acceptable runtime.
For both the \gls{AHTR} plank and one-third assembly models, I used eight precursor 
groups and a four-group energy structure derived by Gentry et al. 
\cite{gentry_development_2016} for \gls{AHTR} geometries. 
Table \ref{tab:energy_structures} defines the 4-group energy boundaries. 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{4-group energy structures for \acrfull{AHTR} geometry 
    derived by Gentry et al. \cite{gentry_development_2016}.}
	\label{tab:energy_structures}
    \footnotesize
    \begin{tabular}{lll}
    \hline
    \multicolumn{3}{c}{\textbf{Group Boundaries [MeV]}} \\ 
    \hline
    \textbf{Group $\#$}& \textbf{Upper Bound} & \textbf{Lower Bound}  \\
    \hline 
    1 & $2.0000\times 10^1$ & $9.1188\times 10^{-3}$ \\ 
    2 & $9.1188\times 10^{-3}$ & $2.9023\times 10^{-5}$\\
    3 & $2.9023\times 10^{-5}$ & $1.8554\times 10^{-6}$\\
    4 & $1.8554\times 10^{-6}$ & $1.0000\times 10^{-12}$\\
    \hline
    \end{tabular}
\end{table}

For spatial homogenization of the straightened \gls{AHTR} plank and 
one-third assembly, I used OpenMC's \textit{cell} domain type to compute 
multigroup cross sections for different \textit{cells}. 
For the \gls{AHTR} plank, I discretized the plank into 13 \textit{cells}:
FLiBe, left graphite, right graphite, and ten fuel cells (each cell has a different 
packing fraction).
Figure \ref{fig:straightened_slab_mg} illustrates the \gls{AHTR} plank's spatial 
homogenization for the OpenMC multigroup calculation. 
\begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{straightened_slab_mg.png}
    \raggedright
    \resizebox{0.5\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{llll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} & 
            \textcolor{fhrgrey}{$\blacksquare$} & Left Graphite \\
            \textcolor{fhrred}{$\blacksquare$} & Right Graphite &
            \textcolor{fhrpink}{$\blacksquare$} & Fuel cell 1/6 \\
            \textcolor{fhryellow}{$\blacksquare$} & Fuel cell 2/7 &
            \textcolor{fhrorange}{$\blacksquare$} & Fuel cell 3/8 \\
            \textcolor{fhrgreen}{$\blacksquare$} & Fuel cell 4/9 &
            \textcolor{fhrpurple}{$\blacksquare$} & Fuel cell 5/10 \\
            \end{tabular}}}
    \caption{Straightened \acrfull{AHTR} fuel plank spatially discretized into 
    13 \textit{cells} for OpenMC multigroup calculation to produce group constants 
    data for the Moltres model.}
    \label{fig:straightened_slab_mg}
\end{figure}

For the \gls{AHTR} one-third assembly, I discretized the one-third assembly into 
70 \textit{cells}: inter-assembly \gls{FLiBe}, Y-shaped graphite structure, control 
rod slot \gls{FLiBe}, inter-plank \gls{FLiBe}, each graphite plank (6), and ten fuel 
cells per plank (60).
Figure \ref{fig:fhr_onethird_assem_homogenization} illustrates the \gls{AHTR} 
one-third assembly's spatial homogenization for the OpenMC multigroup calculation. 
\begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{fhr_onethird_assem_homogenization.png}
    \raggedright
    \resizebox{0.5\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue1}{$\blacksquare$} & inter-assembly \gls{FLiBe} \\
            \textcolor{fhrgrey1}{$\blacksquare$} & Y-shaped graphite structure \\
            \textcolor{fhrblue2}{$\blacksquare$} & control rod slot \gls{FLiBe} \\
            \textcolor{fhrblue3}{$\blacksquare$} & inter-plank \gls{FLiBe} \\
            \textcolor{fhrblack1}{$\blacksquare$} \textcolor{fhrwhite1}{$\blacksquare$} & fuel cells
            \end{tabular}}}
    \caption{Straightened \acrfull{AHTR} one-third assembly spatially discretized into 
    70 \textit{cells} for OpenMC multigroup calculation to produce group constants 
    data for Moltres model.}
    \label{fig:fhr_onethird_assem_homogenization}
\end{figure}

I compared the key neutronics parameters for the continuous OpenMC and multigroup 
Moltres simulations for both the \gls{AHTR} plank and one-third assembly to ensure 
that the spatial and energy homogenization preserve accuracy.
Section \ref{sec:ahtr_model_verification} reports the verification studies results.

\subsubsection{AHTR Moltres Mesh Generation}
I wrote Python scripts for the \gls{AHTR} plank and one-third assembly models 
that accept the \gls{FLiBe} coolant channel shape input parameters 
($r_{top}, r_{bot}, r_1, r_2, r_3, r_4, r_5$) and generate a geometry script file 
(\texttt{.geo}) based on the spatial homogenizations outlined in the previous 
sub-section.
The AHTR geometry mesh is then generated from the geometry script file using 
Gmsh \cite{geuzaine_gmsh_2009}.
I used Gmsh's \textit{refine by splitting} functionality to refine the mesh. 
Figures \ref{fig:ahtr-plank-geo} and \ref{fig:ahtr-assem-geo} show Gmsh rendered 
geometry file examples generated by the geometry scripts for the AHTR plank 
and one-third assembly.
% TODO: update assem figure with varying coolant channel
\begin{figure}[htbp]
    \centering
    \begin{subfigure}{0.7\textwidth}
        \includegraphics[width=\linewidth]{ahtr-plank-geo.png}
        \caption{AHTR plank geometry file}
        \label{fig:ahtr-plank-geo} 
    \end{subfigure}
    \begin{subfigure}{0.7\textwidth}
        \includegraphics[width=\linewidth]{ahtr-assem-geo.png}
        \caption{AHTR one-third assembly geometry file}
        \label{fig:ahtr-assem-geo} 
    \end{subfigure}
    \caption{Examples of Gmsh rendered geometry files generated by the geometry scripts.
    Both geometry files have varying \gls{FLiBe} coolant channel shapes.}
\end{figure}

\subsubsection{AHTR Moltres Temperature Model}
\label{sec:ahtr-moltres-temperature-model}
The Moltres \gls{AHTR} Steady-State Temperature Model is a 2D x-y cross-section 
model of the \gls{AHTR} plank and one-third assembly.
The plank and one-third assembly geometries are depicted in
Figure \ref{fig:straightened_slab_mg} and Figure 
\ref{fig:fhr_onethird_assem_homogenization}, respectively.  
The Moltres temperature model first solves the \gls{AHTR} neutronics and uses that to 
solve the \gls{AHTR}'s temperature distribution for a defined power.
The temperature model assumes conductive heat transfer throughout the domain 
and heat removal by uniform salt flow in the coolant region. 
These assumptions ignore turbulent effects that would most likely be present. 
However, an in-depth AHTR Moltres model that includes turbulence modeling is 
out of scope for this dissertation. 

Moltres solves the four-group diffusion equations 
(Equation \ref{eq:moltres-diffusion-equation}) 
as a steady-state eigenvalue problem to find $k_{eff}$ for the static AHTR models.
In the 2D cross-sectional AHTR Steady-State Temperature Model, I ignore the 
time-dependent and velocity-dependent terms from Moltres' temperature governing 
equation (Equation \ref{eq:moltres-temp}) since it is a steady-state model with
no moving fuel, resulting in Equation \ref{eq:moltres-temp-ss}: 
\begin{align}
    \label{eq:moltres-temp-ss}
    - \nabla \cdot (k_i \nabla T) &= Q_i
\intertext{where}
k_i &= \mbox{thermal conductivity of material i} \nonumber \\
T &= \mbox{temperature in the model} \nonumber \\
Q_i &= \mbox{source or sink term in material i} \nonumber
\end{align} 
I use insulated temperature boundary conditions.  
Table \ref{tab:ahtr-thermal-conductivity} shows the thermal conductivity values 
used for each \gls{AHTR} material. 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{AHTR} materials' thermal conductivities used in Moltres 
    temperature models, taken from \cite{ramey_methodology_2021}.}
	\label{tab:ahtr-thermal-conductivity}
    \footnotesize
    \begin{tabular}{ll}
    \hline 
    \textbf{Material}& \textbf{Thermal Conductivity [$Wcm^{-1}K^{-1}$]} \\ 
    \hline 
    \gls{FLiBe} & 0.01 \\
    Graphite  & 0.15 \\
    Fuel  & 0.099 \\
    \hline
    \end{tabular}
\end{table}

Equation \ref{eq:moltres-source-term} defines the fuel cells' fission source term 
($Q_f$):
\begin{align}
\label{eq:moltres-source-term}
    Q_f &= \sum_{g=1}^G \epsilon_{f,g}\Sigma_{f,g}\phi_g
\intertext{where} 
Q_f &= \mbox{source term } [\frac{MeV}{cm^3s}] \nonumber \\
G &= \mbox{number of discrete groups, g } [-] \nonumber \\
\epsilon_{f,g} &= \mbox{heat produced per fission } [MeV] \nonumber \\
\Sigma_{f,g} &= \mbox{macroscopic cross section for fission due to neutrons in group g } [\frac{1}{cm}] \nonumber \\
\phi_g &= \mbox{flux of neutrons in group g } [\frac{n}{cm^2s}]\nonumber
\end{align}

Equation \ref{eq:moltres-heat-removal} defines the heat removal from the AHTR 
model:
\begin{align}
    \label{eq:moltres-heat-removal}
    Q &= h \cdot A \cdot(T(\vec{r})-T_{ref})
\intertext{where:}
Q &= \mbox{heat removal rate for 1cm thin slice of the AHTR model [W/cm]} \nonumber \\
h &= \mbox{heat transfer coefficient } [\frac{W}{cm^3 \cdot K}] \nonumber \\
A &= \mbox{coolant area } [cm^2] \nonumber \\
T(\vec{r}) &= \mbox{temperature at point $\vec{r}$ [K]} \nonumber \\
T_{ref} &= \mbox{reference temperature [K]} \nonumber
\end{align}

Table \ref{tab:heat-exchanger-constants} shows reference temperature and heat 
transfer coefficient values for the convective heat transfer process.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR plank and one-third assembly heat transfer constants.}
	\label{tab:heat-exchanger-constants}
    \footnotesize
    \begin{tabular}{lllll}
    \hline 
    \textbf{Geometry} & \textbf{Constant}& \textbf{Value}& \textbf{Units} & \textbf{Notes} \\
    \hline 
    Plank & $h_{plank}$ & 990 & $\frac{W}{cm \cdot K}$ & Calculated in Eq. \ref{eq:calc-htc-plank} \\
    One-Third Assembly & $h_{assem}$ & 611 & $\frac{W}{cm \cdot K}$ & Calculated in Eq. \ref{eq:calc-htc-assem} \\
    Both & $T_{ref}$ & 923 & K & AHTR Inlet Temperature \cite{ramey_methodology_2021} \\ 
    \hline
    \end{tabular}
\end{table} 
I calculated the heat transfer coefficient ($h$) for the \gls{AHTR} plank and one-third assembly
using Equation \ref{eq:calc-htc-plank}, \ref{eq:calc-htc-assem} with the following assumptions: 
\begin{itemize}
    \item AHTR models generate constant amount of power, which is all removed by the 
    coolant
    \item a linear increase in temperature from inlet to outlet 
\end{itemize}
\begin{align}
    \label{eq:calc-htc-plank}
    h_{plank} &= \frac{P_{dz}}{V_{coolant}} \div \Delta T \\
      &= \frac{1456 W/cm}{23.1cm \times 0.35cm \times 1cm \times 2} \div 0.0909 K/cm \nonumber \\
      &= 990 W cm^{-3}K^{-1} \nonumber \\
      \label{eq:calc-htc-assem}
      h_{assem} &= \frac{P_{dz}}{V_{coolant}} \div \Delta T \\
      &= \frac{8741 W/cm}{157cm^3} \div 0.0909 K/cm \nonumber \\
      &= 611 W cm^{-3}K^{-1} \nonumber 
\intertext{and}
\Delta T  &= \frac{T_{total}}{H} = \frac{50 K}{550 cm} = 0.0909 K/cm
\intertext{where:}
h_{plank} &= \mbox{plank's heat transfer coefficient } [\frac{W}{cm^3 \cdot K}] \nonumber \\
h_{assem} &= \mbox{one-third assembly's heat transfer coefficient } [\frac{W}{cm^3 \cdot K}] \nonumber \\
P_{dz} &= \mbox{power produced in 1cm AHTR plank/one-third assem $\Delta z$ slice [$W/cm$]}\nonumber \\
V_{coolant} &= \mbox{coolant volume in AHTR plank/one-third assem [$cm^3$]} \nonumber \\
\Delta T &= \mbox{temperature change across 1cm AHTR $\Delta z$ slice [$K$]}\\
T_{total} &= \mbox{total temperature change from inlet to outlet [$K$]} \nonumber \\
H &= \mbox{AHTR height from inlet to outlet [cm]} \nonumber 
\end{align}
The power produced by the \gls{AHTR} plank and one-third models are calculated based 
on the \gls{FHR} benchmark model's specific power of 200 $\frac{W}{gU}$ and the FHR 
benchmark's TRISO packing fractions in the plank and one-third assembly.

In the \gls{ROLLO} optimization simulations, I vary the \gls{FLiBe} coolant channel 
shape. 
During the coolant channel shape variation, I hold the coolant volume constant. 
Since the coolant volume is held constant throughout the coolant channel 
optimization process, I use the same heat transfer coefficient ($h$)
for all the AHTR Moltres temperature models of varying coolant channel shapes.  

\subsection{Output Parameter Calculation}
\label{sec:ahtr_slab_output}
This section describes how I tallied the AHTR model outputs for the ROLLO 
optimization problem objectives (described in Table \ref{tab:objectives}):
total fuel packing fraction, the maximum temperature in the slab, and 
fuel-normalized power peaking factor.  

\gls{ROLLO} will automatically return the total fuel packing fraction output parameter 
since it is also an input parameter.  
In the Moltres AHTR model, I defined a post processor object to return the 
maximum temperature in the plank. 
The fuel-normalized power peaking factor output parameter takes into account 
fuel amount variations across the model.
For the \gls{AHTR} plank and each fuel plank in the \gls{AHTR} one-third fuel assembly, 
I discretized the fuel cell area of the plank into 10 $\times$ 5 blocks.
I then use OpenMC to tally the fission energy production rate (\texttt{fission-q-recoverable}
$[eV/src]$) in each section.
I did not normalize the score to calculate power since the final PPF value is a 
ratio.
Equation \ref{eq:ppf} calculates the fuel-normalized power peaking factor:
\begin{align}
    \label{eq:ppf}
    PPF &= max(\frac{fqr_j}{PF_j}) \div ave(\frac{fqr_j}{PF_j})
\intertext{where}
j &= \mbox{discretized fuel area j} \nonumber \\
PPF &= \mbox{fuel-normalized power peaking factor} \nonumber \\
fqr_j &= \mbox{fission-q-recoverable at position j} \nonumber \\
PF_j &= \mbox{fuel packing fraction at position j} \nonumber
\end{align}

\section{AHTR Moltres Model Verification}
\label{sec:ahtr_model_verification}
In this section, I conduct \gls{AHTR} Moltres model verification for key neutronics parameters.
I set up a criticality eigenvalue problem in Moltres and calculated key neutronics parameters 
using group constants data from OpenMC. 
For both the \gls{AHTR} plank and one-third assembly models, I compare the key neutronics 
parameters between two simulations:
\begin{enumerate}
    \item OpenMC simulation with continuous energy and TRISO-level spatial fidelity 
    \item Moltres simulation with 4-group energy and spatial homogenization
\end{enumerate}
Section \ref{sec:ahtr-moltres-group-constant-gen} outlined the spatial homogenization used.
The OpenMC simulation with TRISO-level fidelity generates the group constants for the 
energy and spatially homogenized Moltres simulation. 

\subsection{AHTR Plank: Key Neutronics Parameters Verification}
\label{sec:plank-knp}
This section compares the following key neutronics parameters: effective 
multiplication factor, reactivity coefficients, flux distribution, and neutron energy 
spectrum for the \gls{AHTR} plank model. 
For this verification study, I used an AHTR plank model with a 0.0979 total packing 
fraction and packing fraction distribution of 
$PF(x) = \left(1.989\cdot sin(0.354\cdot x + 3.143) + 2\right) \cdot NF$. 
Figure \ref{fig:ahtr-plank-verification} shows the AHTR plank model with TRISO-level 
fidelity.
 \begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{ahtr-plank-verification.png}
    \raggedright
    \resizebox{0.3\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} Coolant\\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure) \\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
        \end{tabular}}}
    \caption{\acrfull{AHTR} plank geometry and packing fraction distribution used for 
    \gls{AHTR} plank's key neutronics parameters verification. 
    The white line corresponds to the centerline where flux distribution is measured. }  
    \label{fig:ahtr-plank-verification}
\end{figure}

\subsubsection{AHTR Plank: Effective Multiplication Factor}
Table \ref{tab:keff_ahtr_moltres} compares effective multiplication factor 
for OpenMC simulation with TRISO fidelity, OpenMC simulation using the homogenized 
group constants, and Moltres simulation using the homogenized group constants. 
I included results from a homogenized OpenMC simulation to 
distinguish between differences caused by spatial homogenization, and differing 
OpenMC and Moltres solve methods. 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR plank's $k_{eff}$ values from OpenMC and Moltres at 948K.
    The normalized difference is the pcm difference normalized by $k_{eff}$.}
	\label{tab:keff_ahtr_moltres}
    \footnotesize
    \begin{tabular}{lllcc}
    \hline 
    \textbf{Software}& \textbf{Homogenized?}& \textbf{$k_{eff}$} & \textbf{Difference [pcm]}  
    & \textbf{Normalized Difference [pcm]}\\
    \hline 
    OpenMC & No & $1.41402 \pm 0.00140$ & - & -\\ 
    OpenMC & Yes & $1.41473 \pm 0.00098$ & +71 & +50\\ 
    Moltres & Yes & $1.40696 $ & -706 & -502\\ 
    \hline
    \end{tabular}
\end{table}

The 50pcm $k_{eff}$ difference between continuous and homogenized OpenMC simulations 
is within uncertainty, showing that the selected spatial and energy homogenizations 
are acceptable. 
However, there is a 502 pcm difference in the Moltres simulation's $k_{eff}$.
A possible reason is that the neutron diffusion method used in Moltres does not 
approximate this reactor geometry as well. 
The diffusion coefficients for this reactor type are approximately 1cm.
The \gls{FLiBe} coolant channel has a 0.35cm width which is smaller than the diffusion
coefficient, resulting in poor approximations. 
The $k_{eff}$ values are acceptable since I am not using the Moltres simulation for 
neutronics modeling but for \gls{AHTR} plank temperature modeling. 

\subsubsection{AHTR Plank: Reactivity Coefficients}
Moltres' delayed neutron fraction, $\beta{eff}$, is calculated by taking the 
normalized difference between $k_{eff}$ values with and without DNPs. 
Table \ref{tab:ahtr_plank_moltres_coeffs} shows that the $\beta{eff}$ values from 
OpenMC and Moltres show excellent agreement with a discrepancy of 0.03pcm. 
I calculated the temperature reactivity coefficients using Equation 
\ref{eq:reactivity-coefficient}.
Temperature reactivity feedback arises mainly from Doppler broadening of 
resonance absorption peaks and thermal expansion.
Table \ref{tab:ahtr_plank_moltres_coeffs} also shows that the total temperature 
coefficients from OpenMC and Moltres show good agreement with a discrepancy of 0.23 pcm/K.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR Fuel Plank's $\beta_{eff}$ values from OpenMC and Moltres at 948K, and 
    total reactivity coefficient values calculated from OpenMC and Moltres at 948K and 1100K.}
	\label{tab:ahtr_plank_moltres_coeffs}
    \footnotesize
    \begin{tabular}{llllll}
    \hline 
    \textbf{Software}& \textbf{Homogenized?}& \textbf{$\beta_{eff}$ [pcm]} 
    & \textbf{Diff [pcm]} & \textbf{Total $\frac{\Delta \rho}{\Delta T}$ [pcm/K]} 
    & \textbf{Diff [pcm/K]} \\
    \hline 
    OpenMC & No &  654.31 & - &  -4.26 & - \\ 
    Moltres & Yes & 654.28 & -0.03 & -4.49 & -0.23\\ 
    \hline
    \end{tabular}
\end{table}

\subsubsection{AHTR Plank: Flux Distribution}
The $\epsilon_{f,g}$ and $\Sigma_{f,g}$ terms in the Moltres source term (Equation 
\ref{eq:moltres-source-term}) are provided to Moltres through 
the group constants generated by neutronics software, OpenMC.
Thus, differences in the source term between OpenMC and Moltres are dependent on 
the flux. 
Comparison of flux distributions produced by Moltres and OpenMC are key to ensuring 
that Moltres accurately calculates the temperature distribution.

Figure \ref{fig:flux_948K} shows the 4-group flux distributions for OpenMC and 
Moltres on the \gls{AHTR} plank's centerline, along the x-axis at the y-axis' 
midpoint (white line on Figure \ref{fig:ahtr-plank-verification}). 
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.48\linewidth]{flux_group1_948K.png} 
    \includegraphics[width=0.48\linewidth]{flux_group2_948K.png} 
    \includegraphics[width=0.48\linewidth]{flux_group3_948K.png} 
    \includegraphics[width=0.48\linewidth]{flux_group4_948K.png} 
    \caption{\acrfull{AHTR} plank's centerline neutron flux distribution 
    in 4 groups at 948K. 
    Centerline is the white line in Figure \ref{fig:ahtr-plank-verification}.
    Comparison is between OpenMC simulation with continuous energy 
    and TRISO-level spatial fidelity and Moltres simulation with 4-group energy and 
    spatial homogenization.  
    Energy Group 1: E $> 9.1188 \times 10^{-3}$ MeV, 
    Energy Group 2: $2.9023 \times 10^{-5} < E < 9.1188 \times 10^{-3}$ MeV,
    Energy Group 3:  $1.8556 \times 10^{-5} < E < 2.9023 \times 10^{-5}$ MeV,
    Energy Group 4:  $1.0 \times 10^{-12} < E < 1.8554 \times 10^{-6}$ MeV.}
    \label{fig:flux_948K}
\end{figure}

The OpenMC simulation shows higher flux in Group 1 and lower flux in
Group 2 and 3. 
There is a good overall agreement for each group's flux.

\subsubsection{AHTR Plank: Neutron Energy Spectrum}
Figure \ref{fig:neutron_spectrum_948K} shows the neutron spectrum of the OpenMC 
simulation for both 252 and 4 groups and the 4-group Moltres simulation.
 \begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{neutron_spectrum_948K.png}
    \caption{\acrfull{AHTR} plank's neutron spectrum. Spectrums include 252 
    and 4 group spectrums from OpenMC simulation with continuous energy and 
    TRISO-level spatial fidelity and 4 group spectrum from Moltres simulation with 
    4-group energy and spatial homogenization.}  
    \label{fig:neutron_spectrum_948K}
\end{figure}
There is good agreement between OpenMC and Moltres models 4-group spectrums. 

In summary, Moltres replicated the relevant neutronics parameters with sufficient 
accuracy using OpenMC's group constant data for the \gls{AHTR} plank model. 

\subsection{AHTR One-Third Assembly: Key Neutronics Parameters Verification}
This section compares the following key neutronics parameters: effective multiplication 
factor, reactivity coefficients, flux distribution, and neutron energy spectrum for the 
\gls{AHTR} one-third assembly model. 
For this verification study, I used an AHTR one-third assembly model with a constant 0.0979 total 
packing fraction across all fuel cells.  
Figure \ref{fig:ahtr-assem-verification} shows the \gls{AHTR} one-third assembly 
model with TRISO-level fidelity.
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.6\linewidth]{assem-constant-0.0979-verification.png}
    \resizebox{0.3\textwidth}{!}{
        \hspace{1cm}
        \fbox{\begin{tabular}{ll}
            \textcolor{fhrblue}{$\blacksquare$} & \gls{FLiBe} Coolant\\
            \textcolor{fhrgrey}{$\blacksquare$} & Graphite (Structure) \\
            \textcolor{fhrred}{$\blacksquare$} & Graphite (Fuel Plank) \\
            \textcolor{fhrblack}{$\blacksquare$} & TRISO particle 
        \end{tabular}}}
    \caption{AHTR one-third assembly geometry and packing fraction distribution used for AHTR 
    one-third assembly's key neutronics parameters verification. 
    The white line corresponds to the centerline where flux distribution is measured. }  
    \label{fig:ahtr-assem-verification}
\end{figure}

\subsubsection{AHTR One-Third Assembly: Effective Multiplication Factor}
Table \ref{tab:keff_ahtr_moltres_assem} compares effective multiplication factor 
for OpenMC simulation with TRISO fidelity, OpenMC simulation using the homogenized 
group constants, and Moltres simulation using the homogenized group constants. 
I included results from a homogenized OpenMC simulation to 
distinguish between differences caused by spatial homogenization, and differing 
OpenMC and Moltres solve methods. 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR Fuel Slab's $k_{eff}$ values from OpenMC and Moltres at 948K.
    The normalized difference is the pcm difference normalized by $k_{eff}$}
	\label{tab:keff_ahtr_moltres_assem}
    \footnotesize
    \begin{tabular}{lllcc}
    \hline 
    \textbf{Software}& \textbf{Homogenized?}& \textbf{$k_{eff}$} & \textbf{Difference [pcm]}  
    & \textbf{Normalized Difference [pcm]}\\
    \hline 
    OpenMC & No & $1.41657 \pm 0.00131$ & - & -\\ 
    OpenMC & Yes & $ 1.41670 \pm 0.00116$ & +13 & +9\\ 
    Moltres & Yes & $1.40895 $ & -762 & -537 \\ 
    \hline
    \end{tabular}
\end{table}

The 9pcm $k_{eff}$ difference between continuous and homogenized OpenMC 
simulations is within uncertainty, showing that the selected spatial and energy 
homogenizations are acceptable. 
However, there is a 537pcm difference in the Moltres simulation's $k_{eff}$, similar 
to the \gls{AHTR} plank model's difference in Section \ref{sec:plank-knp}.
Again, a possible reason is that the neutron diffusion method used in Moltres 
does not approximate this reactor geometry as well. 
The diffusion coefficients for this reactor type are approximately 1cm. 
The \gls{FLiBe} coolant channel has a 0.7cm width which is smaller than the diffusion
coefficient, resulting in poor approximations. 
The $k_{eff}$ values are acceptable since I am not using the Moltres simulation for 
neutronics modeling but for \gls{AHTR} one-third assembly temperature modeling. 

\subsubsection{AHTR One-Third Assembly: Reactivity Coefficients}
Moltres' delayed neutron fraction, $\beta{eff}$, is calculated by taking the 
normalized difference between $k_{eff}$ values with and without DNPs. 
The  $\beta{eff}$ values from OpenMC and Moltres in Table 
\ref{tab:ahtr_assem_moltres_coeffs} show excellent agreement with a discrepancy of
 0.8pcm. 
I calculated the temperature reactivity coefficients with Equation 
\ref{eq:reactivity-coefficient}.
Table \ref{tab:ahtr_assem_moltres_coeffs} shows that the total temperature 
coefficients from OpenMC and Moltres show good agreement with a discrepancy of 
0.2 pcm/K.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR one-third assembly's $\beta_{eff}$ values from OpenMC and Moltres at 948K, and 
    total reactivity coefficient values calculated from OpenMC and Moltres at 948K and 1100K.}
	\label{tab:ahtr_assem_moltres_coeffs}
    \footnotesize
    \begin{tabular}{llllll}
    \hline 
    \textbf{Software}& \textbf{Homogenized?}& \textbf{$\beta_{eff}$ [pcm]} 
    & \textbf{Diff [pcm]} & \textbf{Total $\frac{\Delta \rho}{\Delta T}$ [pcm/K]} 
    & \textbf{Diff [pcm/K]} \\
    \hline 
    OpenMC & No &  652.3 & - &  -3.64 & - \\ 
    Moltres & Yes & 651.5 & -0.8 & -3.44 & +0.2\\ 
    \hline
    \end{tabular}
\end{table}

\subsubsection{AHTR One-Third Assembly: Flux Distribution}
The $\epsilon_{f,g}$ and $\Sigma_{f,g}$ terms in the Moltres source term (Equation 
\ref{eq:moltres-source-term}) are provided to Moltres through 
the group constants generated by neutronics software, OpenMC.
Thus, differences in the source term between OpenMC and Moltres are dependent on 
the flux. 
Comparison of flux distributions produced by Moltres and OpenMC are key to 
ensuring that temperature distribution is accurately calculated in Moltres.

Figure \ref{fig:flux_948K_assem} shows the 4-group flux distributions for OpenMC and 
Moltres on the \gls{AHTR} one-third assembly's centerline, along the y-axis at 
the x-axis' midpoint (white line on Figure \ref{fig:ahtr-assem-verification}). 
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.48\linewidth]{flux_group1_948K_assem.png} 
    \includegraphics[width=0.48\linewidth]{flux_group2_948K_assem.png} 
    \includegraphics[width=0.48\linewidth]{flux_group3_948K_assem.png} 
    \includegraphics[width=0.48\linewidth]{flux_group4_948K_assem.png} 
    \caption{\acrfull{AHTR} one-third assembly's centerline neutron flux distribution 
    in 4 groups at 948K. 
    Centerline is the white line in Figure \ref{fig:ahtr-assem-verification}.
    Comparison is between OpenMC simulation with continuous energy 
    and TRISO-level spatial fidelity and Moltres simulation with 4-group energy and 
    spatial homogenization.
    Energy Group 1: E $> 9.1188 \times 10^{-3}$ MeV, 
    Energy Group 2: $2.9023 \times 10^{-5} < E < 9.1188 \times 10^{-3}$ MeV,
    Energy Group 3:  $1.8556 \times 10^{-5} < E < 2.9023 \times 10^{-5}$ MeV,
    Energy Group 4:  $1.0 \times 10^{-12} < E < 1.8554 \times 10^{-6}$ MeV.}
    \label{fig:flux_948K_assem}
\end{figure}

The OpenMC simulation shows slightly higher flux in Group 1 and lower flux in 
Group 2 and 4. 
There is a good overall agreement for each group's flux.

\subsubsection{AHTR One-Third Assembly: Neutron Energy Spectrum}
Figure \ref{fig:assem_neutron_spectrum_948K} shows the one-third assembly's neutron 
spectrum of the OpenMC simulation for 252 and 4 groups and 4-group Moltres 
simulation. 
 \begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{assem_neutron_spectrum_948K.png}
    \caption{\acrfull{AHTR} one-third assembly's neutron spectrum.
    Spectrums include 252 and 4 group spectrums from OpenMC simulation with continuous 
    energy and TRISO-level spatial fidelity and 4 group spectrum from Moltres 
    simulation with 4-group energy and spatial homogenization.}  
    \label{fig:assem_neutron_spectrum_948K}
\end{figure}
There is good agreement between OpenMC and Moltres models 4-group spectrums. 

In summary, Moltres replicated the relevant neutronics parameters with sufficient 
accuracy using OpenMC's group constant data for the \gls{AHTR} one-third assembly 
model. 

\subsection{AHTR Plank and One-Third Assembly: Mesh Refinement Studies}
I performed mesh refinement studies on the \gls{AHTR} plank and one-third assembly 
Moltres temperature models to ensure that their geometry mesh inputs are sufficiently 
converged. 
Tables \ref{tab:ahtr-plank-mesh-refinement} and \ref{tab:ahtr-assem-mesh-refinement}
show the mesh refinement study results for the \gls{AHTR} plank and one-third 
assembly.
The mesh refinement studies report the average, maximum, and normalized 2-norm 
temperature difference between refinement steps (Equation \ref{eq:2-norm-tdiff-i}):
\begin{align}
    \label{eq:2-norm-tdiff-i}
    ||\Delta T_k||_N &= \frac{1}{N}\sqrt{\sum_{i=1}^N(T_{k-1, i} - T_{k, i})^2} \\
\intertext{where}
    ||\Delta T_k||_N &= \mbox{normalized 2-norm temperature difference between refinement steps} \nonumber \\
    N &= \mbox{total number of discretized points} \nonumber \\
    k &= \mbox{refinement step} \nonumber \\
    T_{k-1} &= \mbox{temperatures from previous refinement step} \nonumber \\
    T &= \mbox{temperatures from current refinement step} \nonumber 
\end{align} 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{AHTR} plank's Moltres temperature model's mesh refinement study.}
	\label{tab:ahtr-plank-mesh-refinement}
    \scriptsize
    \begin{tabular}{lp{3.2cm}lp{3.2cm}ll}
        \hline 
        \textbf{Refinement} & \textbf{Max Plank Temp [K]} 
        & \textbf{Diff [K]} & \textbf{Ave Plank Temp [K]}
        & \textbf{Diff [K]} & $||\Delta T_k||_N$\\ 
        \hline 
        1 & 1126.219 & - & 1011.209 & - & - \\
        2 & 1127.711 & +1.492 & 1017.630 & +6.421 & 0.839\\
        3 & 1128.434 & +0.723 & 1020.021 & +2.390 & 0.313\\ 
        \hline
    \end{tabular}
\end{table}
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{AHTR} one-third assembly's Moltres temperature model's mesh 
    refinement study.}
	\label{tab:ahtr-assem-mesh-refinement}
    \scriptsize
    \begin{tabular}{lp{3.2cm}lp{3.1cm}ll}
    \hline 
    \textbf{Refinement} & \textbf{Max One-Third Assembly Temp [K]} 
    & \textbf{Diff [K]} & \textbf{Ave One-Third Assembly Temp [K]}
    & \textbf{Diff [K]} & $||\Delta T_k||_N$\\ 
    \hline 
    1 & 1185.436 & - & 995.963 & - & - \\
    2 & 1186.045 & +0.609 & 1001.751 & +5.788 & 0.703\\
    3 & 1185.994 & -0.051 & 1003.625 & +1.874 & 0.200\\ 
    4 & 1187.658 & +1.664 & 1004.708 & +1.083 & 0.102\\
    \hline
    \end{tabular}
\end{table}

Both \gls{AHTR} plank and one-third assembly show suitable $||\Delta T_k||_N$ 
convergence with more refinement steps. 
I used x3 mesh refinement for all AHTR plank Moltres temperature models and 
x4 mesh refinement for all \gls{AHTR} one-third assembly Moltres temperature 
models. 
Further refinement is unfeasible due to the large mesh size. 
I am using the Theta supercomputer \cite{noauthor_thetathetagpu_nodate} for this work.
Each supercomputer node saves the entire mesh file, further refinement results in 
mesh sizes that are larger than each Theta node's memory size. 

\subsection{AHTR Plank and One-Third Assembly: Group Constant Temperature Study}
During ROLLO optimization, each new reactor model results in the creation of 
a new Moltres temperature model. 
Correspondingly, a new set of group constant data needs to be created. 
Group constant data with multiple temperatures requires running multiple neutronics 
simulations at the various temperatures, thus, increasing the total compute time 
required for each new reactor model. 

This section explores the effects of using multiple temperature group 
constant data compared to single temperature group constant data.
I set up Moltres AHTR steady-state temperature models for the plank and one-third 
assembly with group constant data at each and all the of following temperatures: 948, 
1024, 1100, and 1200 K. 
OpenMC \gls{AHTR} models at the specified temperatures generate the group constant data.

Tables \ref{tab:moltres-group-constant-temps} and 
\ref{tab:moltres-group-constant-temps-assem}
show the average and maximum temperature reported by plank and one-third assembly 
Moltres models and their differences compared to the model with group constant data 
with all four temperatures. 
Both tables also show the normalized 2-norm of the centerline temperature difference 
between the AHTR model with all four temperatures and the AHTR models with single 
temperatures (Equation \ref{eq:2-norm-tdiff-all}):
\begin{align}
    \label{eq:2-norm-tdiff-all}
    ||\Delta T||_N &= \frac{1}{N}\sqrt{\sum_{i=1}^N(T_{all, i} - T_{i})^2} \\
\intertext{where}
    ||\Delta T||_N &= \mbox{normalized 2-norm temperature difference} \nonumber \\
    N &= \mbox{total number of discretized points} \nonumber \\
    T_{all} &= \mbox{temperatures from model with group constant data at all four temperatures} \nonumber \\
    T &= \mbox{temperatures from model with group constant data at one temperature} \nonumber 
\end{align}
The centerlines for the plank and one-third models are depicted in Figures 
\ref{fig:ahtr-plank-verification} and \ref{fig:ahtr-assem-verification}, respectively. 

\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{AHTR} plank's average and maximum temperature and normalized 
    2-norm of the discretized temperature difference across the plank's centerline for 
    varying group constant temperature data. The difference values are calculated from 
    comparison against the model with group constant data with all four temperatures 
    (All).}
	\label{tab:moltres-group-constant-temps}
    \scriptsize
    \begin{tabular}{p{2.5cm}p{2cm}p{2.4cm}p{2cm}p{2.4cm}p{2cm}}
    \hline 
    \textbf{Group Constant Data Temps [K]}& \textbf{Ave Plank Temp [K]}& 
    \textbf{Ave Plank Temp Diff [K]}& \textbf{Max Plank Temp [K]} & 
    \textbf{Max Plank Temp Diff [K]} & $||\Delta T||_N$ \\ 
    \hline 
    All  & 1019.965 &  -     & 1128.306 & -      & -    \\
    948 & 1019.997 &  0.032 & 1128.386 &  0.080 & 0.007\\
    1024 & 1019.989 &  0.023 & 1128.640 &  0.333 & 0.023 \\
    1100 & 1019.976 &  0.011 & 1128.300 & -0.006 & 0.029 \\
    1200 & 1019.943 & -0.023 & 1128.052 & -0.255 & 0.043 \\
    \hline
    \end{tabular}
\end{table}
The temperature differences between the AHTR plank model with all four temperatures 
and the AHTR plank models' with each single temperature are not significant. 
The 948K single temperature group constant data has the lowest 2-norm difference 
($||\Delta T||_N$). 
Thus, I use a 948K in the \gls{AHTR} plank neutronics model to 
generate the group constant data.

\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{AHTR one-third assembly's average and maximum temperature and 2-norm 
    of the discretized temperature difference across the slab's centerline for varying 
    group constant temperature data. The difference values are calculated from 
    comparison against the model with group constant data with all four temperatures 
    (All).}
	\label{tab:moltres-group-constant-temps-assem}
    \scriptsize
    \begin{tabular}{p{2.5cm}p{2.5cm}p{2cm}p{2.5cm}p{2cm}p{2cm}}
    \hline 
    \textbf{Group Constant Data Temps [K]}& \textbf{Ave One-Third Assembly Temp [K]}& 
    \textbf{Diff [K]}& \textbf{Max One-Third Assembly Temp [K]} & 
    \textbf{Diff [K]} & $||\Delta T||_N$ \\ 
    \hline 
    All  & 1004.366 &  -     & 1186.359 & -      & -    \\
    948 & 1004.708 & +0.341 & 1187.658 & +1.299 & 0.044 \\
    1024 & 1004.676 & +0.310 & 1187.148 & +0.788 & 0.041 \\
    1100 & 1004.622 & +0.256 & 1186.085 & -0.274 & 0.046\\
    1200 & 1004.539 & +0.172 & 1185.359 & -1.000 & 0.047 \\
    \hline
    \end{tabular}
\end{table}
The temperature differences between the AHTR one-third assembly model with all four 
temperatures and the AHTR plank models' with each single temperature are small ($<1K$). 
The 1024K single temperature group constant data has the lowest 2-norm difference 
($||\Delta T||_N$). 
Thus, I use 1024K in the \gls{AHTR} one-third assembly neutronics model to generate 
the group constant data.

\section{ROLLO Hyperparameter Tuning}
\label{sec:hyperparameter-studies}
In a \gls{ROLLO} input file, the user defines hyperparameters for the genetic 
algorithm.
A good hyperparameter set guides the optimization process by 
balancing exploitation and exploration to find an optimal solution quickly 
and accurately. 
Finding a good hyperparameter set requires a trial-and-error process. 

The subsequent sections describe the hyperparameter search I conducted for single-objective 
and multi-objective optimization. 

\subsection{ROLLO Single-Objective Optimization Hyperparameters}
\label{sec:rollo-single-hyp}
I performed the single-objective hyperparameter search with a coarse-to-fine random 
sampling scheme, whose advantages I previously discussed in Section \ref{sec:balance}.
I used an \gls{AHTR} plank OpenMC model for the hyperparameter search (Figure 
\ref{fig:straightened_plank}). 
The hyperparameters are population size, number of generations, 
mutation probability, mating probability, selection operator, selection operator's 
number of individuals, selection operator's tournament size, mutation operator, 
and mating operator.  
I started with 25 coarse experiments and fine-tuned the hyperparameters
with 15 more experiments. 
For each genetic algorithm experiment, OpenMC evaluations remained constant at 600.
The number of evaluations correlates with the population size and the number of 
generations. 
I randomly sampled population size and used Equation \ref{eq:pop_gen} to calculate 
the number of generations: 
\begin{align}
    \label{eq:pop_gen}
    \mbox{no. of generations} &= \frac{\mbox{no. of evaluations}}{\mbox{population size} }
\end{align}
Table \ref{tab:hyperparameter_search} shows the lower and upper bounds used 
for randomly sampling each hyperparameter.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{Hyperparameter search is conducted in three phases: \textit{Coarse Search}, 
    \textit{Fine Search 1}, \textit{Fine Search 2}. Each hyperparameter's lower and
    upper bounds for each search phase are listed.}
	\label{tab:hyperparameter_search}
    \footnotesize
    \makebox[\textwidth][c]{\begin{tabular}{p{4cm}lp{3.4cm}p{3.4cm}p{3.4cm}}
    \hline 
    \textbf{Hyperparameter}& \textbf{Type} & \textbf{Coarse Search Bounds} & \textbf{Fine Search 1 Bounds} & \textbf{Fine Search 2 Bounds} \\
    \hline
    Experiments & - & 0 to 24 & 24 to 34 & 35 to 39 \\ 
    \hline
    Population size (pop) & Continuous & 10 $<$ x $<$ 100 & 20 $<$ x $<$ 60 & 60 \\ 
    Mutation probability & Continuous & 0.1 $<$ x $<$ 0.4 & 0.2 $<$ x $<$ 0.4& 0.2 $<$ x $<$ 0.3\\
    Mating probability & Continuous & 0.1 $<$ x $<$ 0.6 &  0.1 $<$ x $<$ 0.3 &  0.45 $<$ x $<$ 0.6\\
    Selection operator & Discrete & \texttt{SelTournament}, \texttt{SelBest}, \texttt{SelNSGA2} & \texttt{SelTournament}, \texttt{SelBest}, \texttt{SelNSGA2}& \texttt{SelTournament}\\
    Selection individuals & Continuous & $\frac{1}{3}pop$ $<$ x $<$ $\frac{2}{3}pop$ & $\frac{1}{3}pop$ $<$ x $<$ $\frac{2}{3}pop$ & 15\\
    Selection tournament size (only for SelTournament) & Continuous & 2 $<$ x $<$ 8 &2 $<$ x $<$ 8&5\\
    Mutation operator & Discrete & \texttt{mutPolynomialBounded} &\texttt{mutPolynomialBounded}&\texttt{mutPolynomialBounded}\\
    Mating operator & Discrete& \texttt{cxOnePoint}, \texttt{cxUniform}, \texttt{cxBlend} &\texttt{cxOnePoint}, \texttt{cxUniform}, \texttt{cxBlend}&\texttt{cxOnePoint}, \texttt{cxBlend}\\ 
    \hline
    \end{tabular}}
\end{table}

The initial 25 coarse experiments' sought to narrow down the hyperparameters 
to find a smaller set of hyperparameter bounds that produce higher $k_{eff}$ values.
Figure \ref{fig:hyperparameter_sens} shows the hyperparameters' plotted against 
each other with a third color dimension representing the average $k_{eff}$ value
($\overline{k_{eff}}$) in each experiment's final generation. 
Lighter scatter points indicate higher final population $\overline{k_{eff}}$ values, 
suggesting better hyperparameter sets. 
\begin{figure}[htbp]
    \centering
    \makebox[\textwidth][c]{\includegraphics[width=1.3\linewidth]{hyperparameter_sens.png}} 
    \caption{Coarse \acrfull{ROLLO} hyperparameters search's results. 
    Hyperparameter values are plotted against each other with a third color dimension 
    representing each experiment's final population's $\overline{k_{eff}}$.}
    \label{fig:hyperparameter_sens}
\end{figure}
I plotted the hyperparameters against each other to visualize the interdependence 
between hyperparameters. 
From the coarse hyperparameter search (Figure \ref{fig:hyperparameter_sens}), 
I noticed the following trends: 
\begin{itemize}
    \item Mutation probability has a higher $\overline{k_{eff}}$, between 0.2 and 0.4. 
    \item Mating probability has a higher $\overline{k_{eff}}$, between 0.1 and 0.3. 
    \item Population size has a higher $\overline{k_{eff}}$, between 20 and 60. 
    \item No obvious interdependence between hyperparameters. 
\end{itemize} 

Next, I proceeded to the fine searches. 
From Figure \ref{fig:hyperparameter_sens}, I narrowed down population size, 
mutation probability, and mating probability bounds, as shown in Table 
\ref{tab:hyperparameter_search}'s \textit{Fine Search 1 Bounds} column. 
I found no significant trends in the other hyperparameters, so I left them 
as is. 
I ran ten more experiments (25 to 34), sampling hyperparameters from 
the \textit{Fine Search 1 Bounds}. 
From these results, I conducted a second fine search with five experiments 
(35 to 39) with further tuned hyperparameter bounds, as shown in Table 
\ref{tab:hyperparameter_search}'s \textit{Fine Search 2 Bounds} column. 
I determined these new hyperparameter bounds based on these reasons: 
\begin{itemize}
    \item Mutation probability has a higher $\overline{k_{eff}}$, between 0.2 and 0.3.
    \item I overlooked $\overline{k_{eff}}$  peaking at mating probability between 
    0.45 and 0.6 in the previous \textit{Fine Search 1}; thus, I shifted the bounds. 
    \item The highest $\overline{k_{eff}}$ occurred for \texttt{selTournament}. 
    \item I narrowed down mating operator options to \texttt{cxBlend} and 
    \texttt{cxOnePoint} since they had higher $\overline{k_{eff}}$ than 
    \texttt{cxUniform}. 
    \item I selected arbitrary numbers for population size, 
    selection individuals, and tournament size since they did not 
    correlate with $\overline{k_{eff}}$ values. 
\end{itemize}
Figure \ref{fig:input_hyperparameters_sens} shows the relationship between 
hyperparameter values and $a$, $b$, $c$ control parameters, final generation 
$k_{eff max}$, and final generation $\overline{k_{eff}}$. 
The coarse experiments' scatter points are $50\%$ transparent, while the fine 
experiments' scatter points are opaque. 
\begin{figure}[htbp]
    \centering
    \makebox[\textwidth][c]{\includegraphics[width=1.3\linewidth]{input_hyperparameters_sens.png}} 
    \caption{ \acrfull{ROLLO} hyperparameters search's results for all 40 experiments 
    (coarse and fine). I plotted the hyperparameters against: a,b,c control parameters, 
    each experiment's final generation $k_{eff max}$, and final generation 
    $\overline{k_{eff}}$ with a third color dimension representing each experiment's final 
    population's $\overline{k_{eff}}$ (color bar representing the $k_{eff}$ values 
    provided on the right side of the figure). Coarse experiments' (0 to 24) scatter points 
    are $50\%$ transparent, while the fine experiments' (24 to 39) scatter points 
    are opaque. }
    \label{fig:input_hyperparameters_sens}
\end{figure}
In Figure \ref{fig:input_hyperparameters_sens}, on average, the fine experiments 
(opaque scatter points) have higher $\overline{k_{eff}}$, which indicates that the
hyperparameter search process met its objective of finding hyperparameter 
bounds that enable quicker and more accurate optimization. 

I ran these simulations on the BlueWaters supercomputer \cite{ncsa_about_2017}. 
In each \gls{ROLLO} simulation, each generation runs a population size number 
of individual OpenMC simulations. 
Each OpenMC simulation takes approximately 13 minutes to run on a single BlueWaters 
XE node. 
With approximately 600 OpenMC evaluations per \gls{ROLLO} simulation, the
\gls{ROLLO} simulation takes about 130 BlueWaters node hours. 
The hyperparameter search ran 40 \gls{ROLLO} simulations, thus using approximately
5200 node hours.

Table \ref{tab:topfive} shows the hyperparameters for the five experiments 
with the highest final generation $\overline{k_{eff}}$.
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{Control Parameters, $k_{eff}$ results, and hyperparameter values for 
    the five hyperparameter search experiments with the highest final generation 
    $\overline{k_{eff}}$.}
	\label{tab:topfive}
    \footnotesize
    \makebox[\textwidth][c]{\begin{tabular}{p{3cm}p{3cm}p{3cm}p{3cm}p{3cm}p{3cm}}
    \hline 
    & \multicolumn{5}{c}{\textbf{Experiment No.}} \\
    \cline{2-6}
    \textbf{Control/Output Parameters} & \textbf{6} & \textbf{15} & \textbf{24} & \textbf{36} & \textbf{39}\\
    \hline 
    $\overline{k_{eff}}$ [-] & 1.39876 &1.40155&1.40118&1.39906&1.40165\\ 
    $k_{eff max}$ [-] & 1.40954 &1.40440&1.40365&1.40590&1.40519\\ 
    a [-] & 1.993&1.998&1.999&1.997&1.989\\
    b [$\frac{radians}{cm}$] & 0.057&0.367&0.320&0.339&0.354\\ 
    c [radians] & 3.571&3.022&3.615&3.053&3.143\\
    \hline
    \textbf{Hyperparameter}& &&&&\\
    Population size & 83 & 28&74&60&60\\ 
    Generations &8&22&9&10&10 \\
    Mutation probability & 0.32 &0.26&0.21&0.23&0.23\\
    Mating probability & 0.17 &0.53&0.48&0.59&0.46\\
    Selection operator & \texttt{selTournament} &\texttt{selTournament}&\texttt{selBest}&\texttt{selTournament}&\texttt{selTournament}\\
    Selection individuals & 38 &14&25&15&15\\
    Selection tournament size & 7 &5&-&5&5\\
    Mutation operator & \texttt{mutPolynomial} \texttt{Bounded}&\texttt{mutPolynomial} \texttt{Bounded}&\texttt{mutPolynomial} \texttt{Bounded}&\texttt{mutPolynomial} \texttt{Bounded}&\texttt{mutPolynomial} \texttt{Bounded}\\
    Mating operator & \texttt{cxOnePoint} &\texttt{cxOnePoint}&\texttt{cxUniform}&\texttt{cxBlend}&\texttt{cxBlend}\\ 
    \hline
    \end{tabular}}
\end{table}
I define the best-performing hyperparameter set as the experiment that produces 
the highest $\overline{k_{eff}}$ in its final generation. 
\textit{Fine Search 2}'s experiment 39 produces the best performing 
hyperparameter set, shown in Table \ref{tab:topfive}, with 
center-peaking packing fraction distribution of $max(k_{eff}) = 1.40519$. 
Therefore, for single-objective ROLLO optimization simulations in this dissertation, 
I use the hyperparameter set from experiment 39. 

\subsection{ROLLO Multi-Objective Optimization Hyperparameters}
Due to a lack of computational resources, I did not use an OpenMC example problem or 
a coarse-to-fine random sampling scheme for the multi-objective optimization 
hyperparameter search.
I used the Binh and Korn function described in Section \ref{sec:binhandkorn} as 
an example problem to conduct the hyperparameter search.

I conducted a simpler hyperparameter search for the multi-objective optimization case. 
I chose to use \texttt{SelNSGA2} for the selection operator, since it is an elitist 
operator that works well for multi-objective optimization. 
Next, I varied each of the following parameters individually and compared their 
hypervolume values: population size/generations, mutation probability, and mating 
probability.
Section \ref{sec:binhandkorn} states that the hypervolume indicator quantifies 
the multi-objective optimization's Pareto front's goodness (larger = better). 

Figure \ref{fig:hypervolume-comparison} shows boxplots comparing hypervolumes 
for varying hyperparameters. 
I ran each simulation 25 times to produce each box plot. 
\begin{figure}[htbp]
    \centering
    \begin{subfigure}{0.55\textwidth}
    \makebox[\textwidth][c]{\includegraphics[width=\linewidth]{hypervolume-comparison-gens.png}} 
    \caption{Population size / Generation variation.}
    \label{fig:hypervolume-comparison-gens}
    \end{subfigure}
    \begin{subfigure}{0.55\textwidth}
        \makebox[\textwidth][c]{\includegraphics[width=\linewidth]{hypervolume-comparison-matpb.png}}
        \caption{Mating probability variation}
        \label{fig:hypervolume-comparison-matpb}
    \end{subfigure}
    \begin{subfigure}{0.55\textwidth}
        \makebox[\textwidth][c]{\includegraphics[width=\linewidth]{hypervolume-comparison-mutpb.png}}
        \caption{Mutation probability variation}
        \label{fig:hypervolume-comparison-mutpb}
    \end{subfigure}
    \caption{Hypervolume comparisons for varying \acrfull{ROLLO} hyperparameters for 
    multi-objective optimization hyperparameter search. }
    \label{fig:hypervolume-comparison}
\end{figure}
Figure \ref{fig:hypervolume-comparison-gens} shows the boxplot comparing hypervolume 
for different population size and generation combinations. 
Similar to Section \ref{sec:rollo-single-hyp}, I held the total number of OpenMC 
evaluations constant at 600. 
Equation \ref{eq:pop_gen} shows the relationship between population size and generations. 
The 120/5 population size /generations combination performs the best with the highest 
hypervolume median (orange line). 

Figure \ref{fig:hypervolume-comparison-matpb} shows a boxplot comparing hypervolume 
for different mating probabilities. 
The 0.9 mutation probability performs the best with the highest hypervolume median 
(orange line), compared to the 0.46 from the best single-objective hyperparameter set 
(Section \ref{sec:rollo-single-hyp}). 
Figure \ref{fig:hypervolume-comparison-mutpb} shows a boxplot comparing hypervolume 
for different mutation probabilities. 
The 0.23 mating probability from the best single-objective hyperparameter set 
(Section \ref{sec:rollo-single-hyp}) performs as well as the 0.1 mating probability. 

Table \ref{tab:multi-obj-hyp} summarizes the hyperparameters I used for \gls{ROLLO} 
multi-objective optimization based on the hyperparameter search. 
\begin{table}[htbp]
    \centering
    \onehalfspacing
    \caption{\acrfull{ROLLO} hyperparameters used for multi-objective optimization.}
	\label{tab:multi-obj-hyp}
    \footnotesize
    \begin{tabular}{ll}
    \hline 
    \textbf{Hyperparameter} & \textbf{Value} \\
    \hline 
    Population size & 120 \\
    Generations & 5 \\
    Mutation probability & 0.9 \\
    Mating probability & 0.23 \\
    Selection operator & \texttt{SelNSGA2} \\
    Mutation operator & \texttt{mutPolynomial} \texttt{Bounded} \\
    Mating operator & \texttt{cxBlend} \\
    \hline
    \end{tabular}
\end{table}

\section{Summary}
This chapter describes the modeling and optimization methodology of the 
\acrfull{AHTR} plank and one-third assembly optimization for non-conventional 
geometries and parameters conducted using the \acrfull{ROLLO} software.
I defined and described the \gls{AHTR} input parameters varied for the optimization 
problems. 
The input parameters include \acrfull{TRISO} packing distribution, total fuel packing 
fraction, and coolant channel shape. 
I defined and motivated the key optimization objectives: minimizing fuel amount,
maximizing heat transfer, and minimizing power peaking.
I described the \gls{AHTR} plank and one-third assembly geometries and  
detailed the \gls{AHTR} modeling workflow: the control variables used to vary 
the input parameters, the OpenMC neutronics model, the Moltres temperature model, and 
the output constraint and objective value calculations. 
I conducted key neutronics parameter verifications, which confirmed that the spatial 
and energy homogenizations used for the plank and one-third assembly Moltres temperature 
models preserved accuracy.
Finally, I described the \gls{ROLLO} hyperparameter tuning process and reported the 
final hyperparameters used for the single and multi-objective optimization problems. 

The following two chapters, the \gls{AHTR} plank optimization results, and \gls{AHTR} 
one-third assembly optimization results, use the described methods.